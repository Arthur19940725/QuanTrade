<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨é¢„æµ‹åŠŸèƒ½è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .result { background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 3px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>ğŸ”§ è‚¡ç¥¨é¢„æµ‹åŠŸèƒ½è°ƒè¯•é¡µé¢</h1>
    
    <div class="debug-section">
        <h3>1. æµ‹è¯•è‚¡ç¥¨æœç´¢API</h3>
        <input type="text" id="search-input" placeholder="è¾“å…¥è‚¡ç¥¨åç§°æˆ–ä»£ç " value="è‹¹æœ">
        <button onclick="testSearchStocks()">æœç´¢è‚¡ç¥¨</button>
        <div id="search-result" class="result"></div>
    </div>
    
    <div class="debug-section">
        <h3>2. æµ‹è¯•è‚¡ç¥¨é¢„æµ‹API</h3>
        <input type="text" id="symbol-input" placeholder="è‚¡ç¥¨ä»£ç " value="AAPL">
        <select id="market-select">
            <option value="us_stocks">ç¾è‚¡</option>
            <option value="hk_stocks">æ¸¯è‚¡</option>
            <option value="cn_stocks">Aè‚¡</option>
            <option value="crypto">åŠ å¯†è´§å¸</option>
        </select>
        <button onclick="testPredictStock()">é¢„æµ‹è‚¡ç¥¨</button>
        <div id="predict-result" class="result"></div>
    </div>
    
    <div class="debug-section">
        <h3>3. æµ‹è¯•å¸‚åœºä¿¡æ¯API</h3>
        <button onclick="testMarketInfo()">è·å–å¸‚åœºä¿¡æ¯</button>
        <div id="market-result" class="result"></div>
    </div>
    
    <div class="debug-section">
        <h3>4. è°ƒè¯•æ—¥å¿—</h3>
        <div id="debug-log" class="result" style="height: 200px; overflow-y: auto;"></div>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script>
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            if (type === 'error') {
                console.error(message);
            } else {
                console.log(message);
            }
        }
        
        function clearLog() {
            document.getElementById('debug-log').textContent = '';
        }
        
        // æµ‹è¯•è‚¡ç¥¨æœç´¢
        async function testSearchStocks() {
            const query = document.getElementById('search-input').value;
            const resultDiv = document.getElementById('search-result');
            
            log(`ğŸ” å¼€å§‹æœç´¢è‚¡ç¥¨: ${query}`);
            
            try {
                const response = await fetch('/api/search-stocks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query: query })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log(`âœ… æœç´¢æˆåŠŸï¼Œæ‰¾åˆ° ${data.count} ä¸ªç»“æœ`);
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h4>æœç´¢ç»“æœ (${data.count} ä¸ª):</h4>
                        ${data.results.map(stock => `
                            <div style="margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">
                                <strong>${stock.symbol}</strong> - ${stock.cn_name} (${stock.en_name})
                                <br><small>å¸‚åœº: ${stock.market} | åŒ¹é…ç±»å‹: ${stock.match_type}</small>
                            </div>
                        `).join('')}
                    `;
                } else {
                    log(`âŒ æœç´¢å¤±è´¥: ${data.error}`, 'error');
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `æœç´¢å¤±è´¥: ${data.error}`;
                }
            } catch (error) {
                log(`âŒ æœç´¢è¯·æ±‚å¼‚å¸¸: ${error.message}`, 'error');
                resultDiv.className = 'result error';
                resultDiv.textContent = `è¯·æ±‚å¼‚å¸¸: ${error.message}`;
            }
        }
        
        // æµ‹è¯•è‚¡ç¥¨é¢„æµ‹
        async function testPredictStock() {
            const symbol = document.getElementById('symbol-input').value;
            const market = document.getElementById('market-select').value;
            const resultDiv = document.getElementById('predict-result');
            
            log(`ğŸ“ˆ å¼€å§‹é¢„æµ‹è‚¡ç¥¨: ${symbol} (${market})`);
            
            try {
                const response = await fetch('/api/predict-stock', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        symbol: symbol,
                        market: market,
                        pred_days: 5,
                        lookback_days: 60
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log(`âœ… é¢„æµ‹æˆåŠŸï¼Œä½¿ç”¨æ¨¡å‹: ${data.model_used}`);
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h4>é¢„æµ‹ç»“æœ:</h4>
                        <p><strong>è‚¡ç¥¨:</strong> ${data.symbol} (${data.market})</p>
                        <p><strong>å½“å‰ä»·æ ¼:</strong> $${data.current_price}</p>
                        <p><strong>é¢„æµ‹ä»·æ ¼:</strong> $${data.summary.final_price}</p>
                        <p><strong>é¢„è®¡æ¶¨è·Œ:</strong> ${data.summary.total_change_pct}% (${data.summary.trend})</p>
                        <p><strong>ä½¿ç”¨æ¨¡å‹:</strong> ${data.model_used}</p>
                        <p><strong>ç½®ä¿¡åº¦:</strong> ${data.summary.confidence}</p>
                        <h5>è¯¦ç»†é¢„æµ‹:</h5>
                        ${data.predictions.slice(0, 3).map(pred => `
                            <div style="margin: 2px 0;">
                                ${pred.date}: $${pred.predicted_price} (${pred.change_pct > 0 ? '+' : ''}${pred.change_pct}%)
                            </div>
                        `).join('')}
                    `;
                } else {
                    log(`âŒ é¢„æµ‹å¤±è´¥: ${data.error}`, 'error');
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `é¢„æµ‹å¤±è´¥: ${data.error}`;
                }
            } catch (error) {
                log(`âŒ é¢„æµ‹è¯·æ±‚å¼‚å¸¸: ${error.message}`, 'error');
                resultDiv.className = 'result error';
                resultDiv.textContent = `è¯·æ±‚å¼‚å¸¸: ${error.message}`;
            }
        }
        
        // æµ‹è¯•å¸‚åœºä¿¡æ¯
        async function testMarketInfo() {
            const resultDiv = document.getElementById('market-result');
            
            log('ğŸŒ è·å–å¸‚åœºä¿¡æ¯');
            
            try {
                const response = await fetch('/api/stock-markets');
                const data = await response.json();
                
                if (data.success) {
                    log(`âœ… å¸‚åœºä¿¡æ¯è·å–æˆåŠŸ`);
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h4>æ”¯æŒçš„å¸‚åœº:</h4>
                        <p><strong>é¢„æµ‹å™¨å¯ç”¨:</strong> ${data.predictor_available ? 'æ˜¯' : 'å¦'}</p>
                        ${Object.entries(data.markets).map(([key, market]) => `
                            <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 3px;">
                                <strong>${market.name}</strong> (${key})
                                <br>${market.description}
                                <br><small>ç¤ºä¾‹: ${market.examples.join(', ')}</small>
                            </div>
                        `).join('')}
                    `;
                } else {
                    log(`âŒ å¸‚åœºä¿¡æ¯è·å–å¤±è´¥: ${data.error}`, 'error');
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `è·å–å¤±è´¥: ${data.error}`;
                }
            } catch (error) {
                log(`âŒ å¸‚åœºä¿¡æ¯è¯·æ±‚å¼‚å¸¸: ${error.message}`, 'error');
                resultDiv.className = 'result error';
                resultDiv.textContent = `è¯·æ±‚å¼‚å¸¸: ${error.message}`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('ğŸš€ è°ƒè¯•é¡µé¢å·²åŠ è½½');
            log('ğŸ’¡ è¯·å…ˆæµ‹è¯•å„ä¸ªAPIåŠŸèƒ½ï¼Œç„¶åæŸ¥çœ‹ä¸»é¡µé¢æ˜¯å¦æ­£å¸¸å·¥ä½œ');
        };
    </script>
</body>
</html>